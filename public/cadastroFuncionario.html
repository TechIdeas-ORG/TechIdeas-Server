<!DOCTYPE html>

<html lang="pt-br">




<head>

    <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Tech Ideas</title>




    <link rel="stylesheet" href="css/style.css">

    <link rel="stylesheet" href="css/forms.css">

</head>




<body>

    <!--Navbar-->

    <div class="nav-container">

        <nav class="index-nav" id="nav">

            <a class='logo' href="#index"><img src="img/semfundox2.png" alt="fotoEmpresa"></a>

            <ul class="nav-list">

                <li><a href="index.html#index">Home</a></li>

                <li><a href="index.html#sobreNos">Sobre Nós</a></li>

                <li><a href="index.html#equipe">Equipe</a></li>

                <li><a href="index.html#produtos">Produtos</a></li>

                <li><a href="index.html#calculadora">Calculadora</a></li>

                <li><a href="index.html#contato">Contatos</a></li>

                <div class="auth-container">

                    <a href="login.html">

                        <div class="anim-auth left"></div>Login

                    </a>

                    <a href="cadastro.html">Registro<div class="anim-auth right"></div></a>

                </div>

            </ul>

        </nav>

    </div>

    <div class="formulario">

        <div class="centralizador">

            <div class="titulo">

                <H1>Cadastro</H1>

                <div></div>

            </div>

            <div class="inputs">

                Nome: <input type="text" required id="ipt_nomeFuncionario"><br><br>

                E-mail <input type="text" required id="ipt_emailFuncionario"><br><br>

                Senha <input type="password" required id="ipt_senhaFuncionario"><br><br>


                <button onclick="verify()">Cadastrar-se</button>
                
            </div>

        </div>

    </div>

</body>


</html>

<script>

    var nomeFuncionario, email, senha;

    function verify() {

        nomeFuncionario = ipt_nomeFuncionario.value;

        email = ipt_emailFuncionario.value;

        senha = ipt_senhaFuncionario.value;

        
        var erro = false;

        if (nomeFuncionario.length < 3) {

            alert("Por favor, insira um nome de uma empresa válido")

            erro = true;

        }

        if (email.indexOf('@') == -1 || email.length < 10) {
            
            alert("Por favor, insira um email válido")

            erro = true;

        }

        if (senha.length < 7) {

            alert("Insira um senha válida");

            erro = true;

        }

        if (erro == false) {
            
            cadastrar_auth();
            
        }
        
    }




    async function requisicao(URL, dados) {
        
        return new Promise((resolve, reject) => {
            
            fetch(URL, {
                
                method: "POST",
                headers: {
                    
                    "Content-Type": "application/json"

                },

                body: JSON.stringify(dados)

            })

            .then(function (resposta) {
                
                    resolve(resposta);
                    
                })

                .catch(function (resposta) {

                    reject(resposta);

                });
                
            });

    }


    async function cadastrar_auth() {
        
        
        /* CADASTRAR USUÁRIO*/

        var fkEmpresa = sessionStorage.FK_EMPRESA;

        var dados = {

            nomeFuncionarioServer: nomeFuncionario,

            emailServer: email,

            senhaServer: senha,

            fkEmpresaServer: fkEmpresa

        };


        var req_Dados = await requisicao('/usuario/cadastrar', dados);


        if (req_Dados.ok) {

            alert('Cadastro feito\nPor Favor Faça Login');

            window.location.href = 'login.html';

        } else {

            console.log('ERRO', req_Dados);

        }

    }

</script>