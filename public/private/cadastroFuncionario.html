<!doctype html>
<html>

<head>
    <title>Gerenciamento Funcionarios</title>
    
    <link rel="stylesheet" href="CSS/style.css">
    <link rel="stylesheet" href="CSS/dashboard.css">
</head>

<body>
    <nav id="navbar">
        <div class="collapse" onclick="collapse()">
            <span class="material-symbols-rounded" id="collapse_text">
                chevron_left
            </span>
        </div>

        <div class="head">
            <img src="img/Logo.png">
            <h3>SMFP<br><span>Sistema de Mapeamento de Fluxo de Pessoas</span></h3>
        </div>
        <div class="menu">
            <ul>
                <li class="active"><a href="index.html">DashBoard</a></li>
                <li><a href="index.html">Mapa de Calor</a></li>
                <li><a href="index.html">Ambientes</a></li>
            </ul>
        </div>
        <div class="account">
            <span class="material-symbols-rounded">
                account_circle
            </span>
            <div class="perfil">
                <h3>Nome do Usuário</h3>
                <a href="logout.html">Sair</a>
            </div>
        </div>
    </nav>
    
    <div class="formulario">

        <div class="centralizador">

            <div class="titulo">

                <H1>Cadastro</H1>

                <div></div>

            </div>

            <div class="inputs">

                Nome: <input type="text" required id="ipt_nomeFuncionario"><br><br>

                E-mail <input type="text" required id="ipt_emailFuncionario"><br><br>

                Senha <input type="password" required id="ipt_senhaFuncionario"><br><br>


                <button onclick="verify()">Cadastrar</button>
                
            </div>

        </div>

    </div>

    <script>

        var nomeFuncionario, email, senha;
    
        function verify() {
    
            nomeFuncionario = ipt_nomeFuncionario.value;
    
            email = ipt_emailFuncionario.value;
    
            senha = ipt_senhaFuncionario.value;
    
            
            var erro = false;
    
            if (nomeFuncionario.length < 2) {
    
                alert("Por favor, insira um nome de um funcinario válido")
    
                erro = true;
    
            }
    
            if (email.indexOf('@') == -1 || email.length < 10) {
                
                alert("Por favor, insira um email válido")
    
                erro = true;
    
            }
    
            if (senha.length < 7) {
    
                alert("Insira um senha válida");
    
                erro = true;
    
            }
    
            if (erro == false) {
                
                cadastrar_auth();
                
            }
            
        }
    
    
    
    
        async function requisicao(URL, dados) {
            
            return new Promise((resolve, reject) => {
                
                fetch(URL, {
                    
                    method: "POST",
                    headers: {
                        
                        "Content-Type": "application/json"
    
                    },
    
                    body: JSON.stringify(dados)
    
                })
    
                .then(function (resposta) {
                    
                        resolve(resposta);
                        
                    })
    
                    .catch(function (resposta) {
    
                        reject(resposta);
    
                    });
                    
                });
    
        }
    
    
        async function cadastrar_auth() {
            
            
            /* CADASTRAR USUÁRIO*/
    
            var fkEmpresa = sessionStorage.FK_EMPRESA;
    
            var dados = {
    
                nomeFuncionarioServer: nomeFuncionario,
    
                emailServer: email,
    
                senhaServer: senha,
    
                fkEmpresaServer: fkEmpresa
    
            };
    
    
            var req_Dados = await requisicao('/usuario/cadastrar', dados);
    
    
            if (req_Dados.ok) {
    
                alert('Cadastro realizado com Sucesso!');
    
            } else {
    
                console.log('ERRO', req_Dados);
    
            }
    
        }
    
    </script>

    <script src="js/navbar.js"></script>
</body>

</html>